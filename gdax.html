<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
	<link rel="stylesheet" href="./index.css">
</head>
<body>
	<nav class="navbar navbar-expand-md navbar-dark sticky-top bg-dark p-2">
		<a class="navbar-brand mr-auto ml-3" href="#">Cointrack.io</a>
		<ul class="nav navbar-nav">
			<li class="nav-item">
				<a class="nav-link" href="#">Log in</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#">Register</a>
			</li>
		</ul>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<nav class="col-md-2 d-none d-md-block bg-dark sidebar">
				<div class="sidebar-sticky">
					<br>
					<br>
					<h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
						Traders
					</h6>
					<ul class="nav flex-column">
						<li class="nav-item">
							<a class="nav-link text-white" href="./gdax.html"><img class="img-fluid align-top mr-2" style="height:25px;" src="https://cryptocoincharts.info/img/exchanges/gdax.svg"> GDAX</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-secondary" href="#"><img class="img-fluid align-top mr-2" style="height:25px;" src="https://cryptocoincharts.info/img/exchanges/bittrex.svg"> Bittrex</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-secondary" href="#"><img class="img-fluid align-top mr-2" style="height:25px;" src="https://cryptocoincharts.info/img/exchanges/kucoin.svg"> Kucoin</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-secondary" href="#"><img class="img-fluid align-top mr-2" style="height:25px;" src="https://cryptocoincharts.info/img/exchanges/bitfinex.svg"> Bitfinex</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-secondary" href="#"><img class="img-fluid align-top mr-2" style="height:25px;" src="https://cryptocoincharts.info/img/exchanges/kraken.svg"> Kraken</a>
						</li>
						<li class="nav-item">
							<a class="nav-link text-secondary" href="#">...</a>
						</li>
					</ul>
				</div>
			</nav>
			<main role="main" class="col-md-10 ml-sm-auto col-lg-10 p-0">
				<div class="table-responsive">
					<table class="table table-hover table-dark" id="dataTable">
						<thead>
							<tr>
								<th>ID</th>
								<th>Open</th>
								<th>High</th>
								<th>Low</th>
								<th>Volume</th>
								<th>Last</th>
								<th>Trend</th>
							</tr>
						</thead>
						<tbody>
							
						</tbody>
					</table>
				</div>
			</main>
		</div>
	</div>

	<script type="text/javascript">
		function wait(ms)
		{
			var start = new Date().getTime();
			var end = start;
			while (end < start + ms)
			{
				end = new Date().getTime();
			}
		}
		function exists (table, id)
		{
			for (var i = 0; i < table.rows.length; i++)
			{
				if (table.rows[i].cells[0].innerHTML == id)
				{
					console.log(id);
					console.log(table.rows[i].cells[0].innerHTML);
					return i;
				}
			}
			return -1;
		}
		function updateDataTable(x, y)
		{
			var dataTable = document.getElementById("dataTable");
			var existe = exists(dataTable, x);
			if (existe != -1)
			{
				var row = dataTable.insertRow(existe);
				dataTable.deleteRow(existe + 1)
			}
			else
			{
				var row = dataTable.insertRow(-1);
			}
			console.log(existe);

			var cell = row.insertCell(0);
			cell.innerHTML = x;

			cell = row.insertCell(1);
			cell.innerHTML = y.open;

			cell = row.insertCell(2);
			cell.innerHTML = y.high;

			cell = row.insertCell(3);
			cell.innerHTML = y.low;

			cell = row.insertCell(4);
			cell.innerHTML = y.volume;

			cell = row.insertCell(5);
			cell.innerHTML = y.last;
		}
		// window.onload = getProductsGdax();
		window.setInterval(function(){
			getProductsGdax();
		}, 2000);
		var windowIsFocused = true;
		function onBlur()
		{
			windowIsFocused = false;
			console.log(windowIsFocused);
		}
		function onFocus()
		{
			windowIsFocused = true;
			console.log(windowIsFocused);
		}
		function getProductsGdax()
		{
			var request = new XMLHttpRequest;
			var key, txt = "";
			request.onreadystatechange = function()
			{
				if (this.readyState == 4 && this.status == 200) // Se recibe el json de productos
				{
					var res = JSON.parse(request.responseText);
					console.log(res);
					document.getElementById("dataTable")
					for (key in res)
					{
						updateDataTable(key, res[key].stats_24hour);
					}
				}
			}
			request.open("GET", "https://api.gdax.com/products/stats", true);
			request.send();
		}
		// function processrequest01(e)
		// {
		// 	if (request01.readyState == 4)
		// 	{
		// 		if (request01.status == 200)
		// 		{
		// 			var response01 = JSON.parse(request01.response);
		// 			var requestString;

		// 			for (var i = 0; i < 1 /*response01.length*/; i++)
		// 			{
		// 				requestString = "https://api-public.sandbox.gdax.com/products/" + response01[i].id + "/stats";
		// 				console.log(requestString);
		// 				requestArray[i] = new XMLHttpRequest();
		// 				requestArray[i].open('GET', requestString, true);
		// 				requestArray[i].addEventListener("readystatechange", processrequest02(requestArray[i], responseArray[i]), false);
		// 				requestArray[i].send();
		// 			}
		// 		}
		// 	}
		// }
		// function processrequest02(req, res)
		// {
		// 	console.log(req);
		// 	if (req.readyState == 4)
		// 	{
		// 		if (req.status == 200)
		// 		{
		// 			console.log("test");
		// 			var response = JSON.parse(req.response);
		// 			console.log(response);
		// 		}
		// 	}
		// }

		// var request01 = new XMLHttpRequest();
		// var request02 = new XMLHttpRequest();
		// var requestArray = [9];
		// var responseArray = [9];
		// var response01;

		// request01.open('GET', "https://api-public.sandbox.gdax.com/products", true);
		// request01.send();
		// request01.addEventListener("readystatechange", processrequest01, false);
	</script>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
</body>
</html>